(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[         0,          0]
NotebookOptionsPosition[         0,          0]
NotebookOutlinePosition[         0,          0]
CellTagsIndexPosition[         0,          0]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Finite clump size", "Section",
 CellChangeTimes->{{3.7433022023344717`*^9, 3.743302206612899*^9}}],

Cell[TextData[{
 "For a DM clump, the source term in the propagation equation is\n\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"Q", "(", 
     RowBox[{
      SubscriptBox["x", "s"], ",", 
      SubscriptBox["E", "s"]}], ")"}], "=", 
    RowBox[{
     SuperscriptBox[
      RowBox[{
       FractionBox[
        RowBox[{"〈", "σv", "〉"}], 
        
        RowBox[{"2", " ", 
         SuperscriptBox["m", "2"]}]], "[", 
       RowBox[{
        SubscriptBox["ρ", "NFW"], "(", 
        RowBox[{"|", 
         RowBox[{
          SubscriptBox["x", "s"], "-", 
          SubscriptBox["x", "c"]}], "|"}], ")"}], "]"}], "2"], "2", " ", 
     RowBox[{"δ", "(", 
      RowBox[{
       SubscriptBox["E", "s"], "-", "m"}], ")"}]}]}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ",\n\nwhere ",
 Cell[BoxData[
  FormBox[
   SubscriptBox["x", "c"], TraditionalForm]],
  FormatType->"TraditionalForm"],
 " is the vector to the clump's center. Using the Greens \
function, the resulting energy distribution function at Earth (x=(0,0,0)) is\n\
\n\t",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"f", "(", "E", ")"}], "=", 
    RowBox[{
     FractionBox[
      RowBox[{"2", "π"}], 
      SuperscriptBox["m", "2"]], 
     RowBox[{
      SuperscriptBox[
       SubscriptBox["∫", "0"], "∞"], 
      RowBox[{"dr", " ", 
       SuperscriptBox["r", "2"], 
       SuperscriptBox["e", 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           SuperscriptBox["r", "2"]}], "/", "4"}], 
         RowBox[{"λ", "(", "E", ")"}]}]], 
       RowBox[{
        SuperscriptBox[
         SubscriptBox["∫", 
          RowBox[{"-", "1"}]], "1"], 
        SubscriptBox["dc", "θ"]}]}]}]}]}], TraditionalForm]],
  FormatType->"TraditionalForm"]
}], "Text",
 CellChangeTimes->{{3.743302247027089*^9, 3.74330238764389*^9}, {
  3.743302587824827*^9, 3.743302615407394*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"$Assumptions", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"r", ">", "0"}], ",", 
     RowBox[{"rs", ">", "0"}], ",", 
     RowBox[{"ρs", ">", "0"}], ",", 
     RowBox[{"dc", ">", "0"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.743256496697859*^9, 3.743256510683956*^9}, 
   3.743256610908119*^9, 3.743256990254653*^9, {3.743257033594236*^9, 
   3.743257034761334*^9}}],

Cell["\<\
NFW profile with no density cutoff at the center\
\>", "Text",
 CellChangeTimes->{{3.743302219524355*^9, 3.7433022293557453`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"rhoNFW0", "[", "r_", "]"}], ":=", 
    RowBox[{"ρs", 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["r", "rs"], ")"}], 
      RowBox[{"-", "γ"}]], 
     SuperscriptBox[
      RowBox[{"(", 
       RowBox[{"1", "+", 
        FractionBox["r", "rs"]}], ")"}], 
      RowBox[{"γ", "-", "3"}]]}]}], ";"}], 
  RowBox[{"(*", 
   RowBox[{"/.", 
    RowBox[{"γ", "->", "0.5"}]}], "*)"}]}]], "Input",
 CellChangeTimes->{{3.743256452511278*^9, 3.743256494628409*^9}, {
   3.743256604106769*^9, 3.7432566199483967`*^9}, {3.743256803430484*^9, 
   3.7432568048862343`*^9}, 3.7432568483915167`*^9, {3.743256970505368*^9, 
   3.743257004922736*^9}, 3.743257580712756*^9, {3.74336061784457*^9, 
   3.743360619977894*^9}}],

Cell["", "Text",
 CellChangeTimes->{{3.743302238308551*^9, 3.743302243746677*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"θIndefInt", "=", 
   RowBox[{"Integrate", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"rhoNFW0", "[", 
       SqrtBox[
        RowBox[{
         SuperscriptBox["dc", "2"], "+", 
         SuperscriptBox["r", "2"], "-", 
         RowBox[{"2", "dc", " ", "r", " ", "cθ"}]}]], "]"}], "2"], ",",
      "cθ"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.743257018495907*^9, 3.743257058083212*^9}, {
   3.7432576570000772`*^9, 3.74325765892461*^9}, {3.743257838745037*^9, 
   3.743257840823904*^9}, {3.743258556957653*^9, 3.743258581061219*^9}, {
   3.7433008024085693`*^9, 3.743300858286929*^9}, 3.743301029653348*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"θIndefInt", "/.", 
     RowBox[{"cθ", "->", "1"}]}], ")"}], "-", 
   RowBox[{"(", 
    RowBox[{"θIndefInt", "/.", 
     RowBox[{"cθ", "->", 
      RowBox[{"-", "1"}]}]}], ")"}]}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.743300859917045*^9, 3.743300913547512*^9}, {
  3.7433010673436823`*^9, 3.7433010680202713`*^9}}],

Cell[BoxData[
 FormBox["$Aborted", TraditionalForm]], "Output",
 CellChangeTimes->{{3.743300862422144*^9, 3.7433009147202473`*^9}, {
   3.743301033310774*^9, 3.74330105787738*^9}, 3.743301098483254*^9, 
   3.74389481623514*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"FortranForm", "[", "%", "]"}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"γ", "->", "gamma"}], ",", 
    RowBox[{"ρs", "->", "rhos"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.7433011921482143`*^9, 3.743301232475452*^9}}],

Cell["\<\
        (rhos**2*rs**2*((dc + r)**(2 - 2*gamma)*(dc + r + rs)**(-5 + \
2*gamma)*
     -       (3*dc**2*(dc + r + (5 - 2*gamma)*rs) + 
     -         6*dc*r*(dc + r + (5 - 2*gamma)*rs) + 
     -         3*r**2*(dc + r + (5 - 2*gamma)*rs) + 
     -         (10 - 9*gamma + 2*gamma**2)*rs**2*
     -          (3*(dc + r) + 3*rs - 2*gamma*rs)) + 
     -      Abs(dc - r)**(2 - 2*gamma)*(rs + Abs(dc - r))**(-5 + 2*gamma)*
     -       ((-5 + 2*gamma)*rs*
     -          (3*dc**2 - 6*dc*r + 3*r**2 + (6 - 7*gamma + \
2*gamma**2)*rs**2)
     -           - 3*(dc**2 - 2*dc*r + r**2 + 
     -            (10 - 9*gamma + 2*gamma**2)*rs**2)*Abs(dc - r))))/
     -  (2.*dc*(-2 + gamma)*(-1 + gamma)*(-5 + 2*gamma)*(-3 + 2*gamma)*r)\
\>", "Output",
 CellChangeTimes->{{3.743301195279244*^9, 3.7433012280380077`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"θIndefInt", "/.", 
       RowBox[{"cθ", "->", "1"}]}], ")"}], " ", "-", 
     RowBox[{"(", 
      RowBox[{"θIndefInt", "/.", 
       RowBox[{"cθ", "->", "ctmax"}]}], ")"}]}], ")"}], "/.", 
   RowBox[{"γ", "->", "gamma"}]}], "//", "FortranForm"}]], "Input",\

 CellChangeTimes->{{3.7438948431249533`*^9, 3.743894865800609*^9}, {
  3.743895664177679*^9, 3.743895738022513*^9}, {3.74404957496348*^9, 
  3.744049577214691*^9}}],

Cell["\<\
        -((dc**2 - 2*dc*r + r**2)**(1 - gamma)*rs**2*
     -      (Sqrt(dc**2 - 2*dc*r + r**2) + rs)**(-5 + 2*gamma)*
     -      (3*dc**2*(Sqrt(dc**2 - 2*dc*r + r**2) + (5 - 2*gamma)*rs) - 
     -        6*dc*r*(Sqrt(dc**2 - 2*dc*r + r**2) + (5 - 2*gamma)*rs) + 
     -        (10 - 9*gamma + 2*gamma**2)*rs**2*
     -         (3*Sqrt(dc**2 - 2*dc*r + r**2) + 3*rs - 2*gamma*rs) + 
     -        3*r**2*(Sqrt(dc**2 - 2*dc*r + r**2) + 5*rs - \
2*gamma*rs))*ρs**2)
     -    /(2.*dc*(-2 + gamma)*(-1 + gamma)*(-5 + 2*gamma)*(-3 + \
2*gamma)*r)\\
     -   + ((dc**2 - 2*ctmax*dc*r + r**2)**(1 - gamma)*rs**2*
     -     (Sqrt(dc**2 - 2*ctmax*dc*r + r**2) + rs)**(-5 + 2*gamma)*
     -     (3*dc**2*(Sqrt(dc**2 - 2*ctmax*dc*r + r**2) + (5 - 2*gamma)*rs) - 
     -       6*ctmax*dc*r*(Sqrt(dc**2 - 2*ctmax*dc*r + r**2) + 
     -          (5 - 2*gamma)*rs) + 
     -       (10 - 9*gamma + 2*gamma**2)*rs**2*
     -        (3*Sqrt(dc**2 - 2*ctmax*dc*r + r**2) + 3*rs - 2*gamma*rs) + 
     -       3*r**2*(Sqrt(dc**2 - 2*ctmax*dc*r + r**2) + 5*rs - 2*gamma*rs))*
     -     ρs**2)/
     -   (2.*dc*(-2 + gamma)*(-1 + gamma)*(-5 + 2*gamma)*(-3 + 2*gamma)*r)\
\>", "Output",
 CellChangeTimes->{{3.74389484702015*^9, 3.743894862678164*^9}, 
   3.743894947631386*^9, {3.743895662221526*^9, 3.743895675735095*^9}, {
   3.743895714447521*^9, 3.743895742084578*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"θIndefInt", "/.", 
    RowBox[{"cθ", "->", "ct"}]}], "/.", 
   RowBox[{"γ", "->", "gamma"}]}], "//", "FortranForm"}]], "Input",\

 CellChangeTimes->{{3.744049582371768*^9, 3.744049586502924*^9}}],

Cell["\<\
        -((dc**2 - 2*ct*dc*r + r**2)**(1 - gamma)*rs**2*
     -     (Sqrt(dc**2 - 2*ct*dc*r + r**2) + rs)**(-5 + 2*gamma)*
     -     (3*dc**2*(Sqrt(dc**2 - 2*ct*dc*r + r**2) + (5 - 2*gamma)*rs) - 
     -       6*ct*dc*r*(Sqrt(dc**2 - 2*ct*dc*r + r**2) + (5 - 2*gamma)*rs) + 
     -       (10 - 9*gamma + 2*gamma**2)*rs**2*
     -        (3*Sqrt(dc**2 - 2*ct*dc*r + r**2) + 3*rs - 2*gamma*rs) + 
     -       3*r**2*(Sqrt(dc**2 - 2*ct*dc*r + r**2) + 5*rs - 2*gamma*rs))*
     -     ρs**2)/
     -  (2.*dc*(-2 + gamma)*(-1 + gamma)*(-5 + 2*gamma)*(-3 + 2*gamma)*r)\
\>", "Output",
 CellChangeTimes->{3.744049587606927*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"4", "π", " ", 
  RowBox[{"Integrate", "[", 
   RowBox[{
    RowBox[{
     SuperscriptBox[
      RowBox[{"rhoNFW0", "[", "r", "]"}], "2"], "/.", 
     RowBox[{"γ", "->", "1"}]}], ",", "r"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.744305982987608*^9, 3.7443060211821527`*^9}, {
  3.7443062378878117`*^9, 3.744306247077374*^9}, {3.744306368277383*^9, 
  3.7443063873869047`*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{
   RowBox[{"-", 
    FractionBox["4", "3"]}], " ", "π", " ", 
   SuperscriptBox["ρs", "2"], " ", "rs", " ", 
   RowBox[{"(", 
    RowBox[{
     FractionBox[
      RowBox[{"rs", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"12", " ", 
          SuperscriptBox["r", "3"]}], "+", 
         RowBox[{"30", " ", 
          SuperscriptBox["r", "2"], " ", "rs"}], "+", 
         RowBox[{"22", " ", "r", " ", 
          SuperscriptBox["rs", "2"]}], "+", 
         RowBox[{"3", " ", 
          SuperscriptBox["rs", "3"]}]}], ")"}]}], 
      RowBox[{"r", " ", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{"r", "+", "rs"}], ")"}], "3"]}]], "-", 
     RowBox[{"12", " ", 
      RowBox[{"log", "(", 
       RowBox[{"r", "+", "rs"}], ")"}]}], "+", 
     RowBox[{"12", " ", 
      RowBox[{"log", "(", "r", ")"}]}]}], ")"}]}], TraditionalForm]], "Output",\

 CellChangeTimes->{{3.7443060027011833`*^9, 3.744306022224742*^9}, {
  3.744306238847962*^9, 3.744306247677141*^9}, {3.744306373125119*^9, 
  3.744306388258277*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["Scratch", "Section",
 CellChangeTimes->{{3.743302185399105*^9, 3.743302186244879*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"b", "[", "e_", "]"}], ":=", 
  RowBox[{"b0", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"e", "/", "e0"}], ")"}], "2"]}]}], "", 
 RowBox[{
  RowBox[{"diff", "[", "e_", "]"}], ":=", 
  RowBox[{"d0", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"e", "/", "e0"}], ")"}], 
    "δ"]}]}], "", 
 RowBox[{
  RowBox[{"λ", "[", 
   RowBox[{"e_", ",", "mx_"}], "]"}], ":=", 
  FractionBox[
   RowBox[{
    RowBox[{"d0", " ", 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["e", "e0"], ")"}], "δ"], " ", 
     SuperscriptBox["e0", "2"], " ", "mx"}], "-", 
    RowBox[{"d0", " ", "e", " ", 
     SuperscriptBox["e0", "2"], " ", 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["mx", "e0"], ")"}], "δ"]}]}], 
   RowBox[{
    RowBox[{"b0", " ", "e", " ", "mx"}], "-", 
    RowBox[{"b0", " ", "e", " ", "mx", " ", "δ"}]}]]}]}], "Input",
 CellChangeTimes->{{3.738001138271308*^9, 3.738001166168673*^9}, {
  3.738282259761265*^9, 3.7382822601420183`*^9}, {3.738282331128681*^9, 
  3.738282361488265*^9}, {3.73828407672075*^9, 3.738284095212064*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{" ", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"Integrate", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"diff", "[", "e", "]"}], "/", 
           RowBox[{"b", "[", "e", "]"}]}], ",", "e"}], "]"}], "/.", 
        RowBox[{"e", "->", "mx"}]}], ")"}], "-", 
      RowBox[{"Integrate", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"diff", "[", "e", "]"}], "/", 
         RowBox[{"b", "[", "e", "]"}]}], ",", "e"}], "]"}]}], " ", "//", 
     "Together"}], "//", "FullSimplify"}], "//", "StandardForm"}]}]], "Input",\

 CellChangeTimes->{{3.738001134103434*^9, 3.738001135217432*^9}, {
  3.7380011694088287`*^9, 3.738001231417594*^9}, {3.7380015068844547`*^9, 
  3.738001538332638*^9}, {3.738001702397485*^9, 3.7380017206913643`*^9}, {
  3.738001758224513*^9, 3.738001814604014*^9}, {3.7382840521571083`*^9, 
  3.738284072291687*^9}}],

Cell[BoxData[
 FractionBox[
  RowBox[{
   RowBox[{"d0", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["e", "e0"], ")"}], "δ"], " ", 
    SuperscriptBox["e0", "2"], " ", "mx"}], "-", 
   RowBox[{"d0", " ", "e", " ", 
    SuperscriptBox["e0", "2"], " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["mx", "e0"], ")"}], "δ"]}]}], 
  RowBox[{
   RowBox[{"b0", " ", "e", " ", "mx"}], "-", 
   RowBox[{"b0", " ", "e", " ", "mx", " ", "δ"}]}]]], "Output",
 CellChangeTimes->{{3.738001173212563*^9, 3.738001231961708*^9}, {
   3.738001510590972*^9, 3.7380015388236217`*^9}, 3.738001721137779*^9, {
   3.738001759054234*^9, 3.7380017717746677`*^9}, {3.738001805059342*^9, 
   3.738001814937635*^9}, {3.738284053431304*^9, 3.738284072725235*^9}, 
   3.738693786108171*^9}]
}, Closed]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ϕe", "[", 
   RowBox[{"e_", ",", "mx_", ",", "d_"}], "]"}], ":=", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"b", "[", "e", "]"}]], 
   FractionBox[
    RowBox[{"Exp", "[", 
     RowBox[{"-", 
      FractionBox[
       SuperscriptBox["d", "2"], 
       RowBox[{"4", " ", 
        RowBox[{"λ", "[", 
         RowBox[{"e", ",", "mx"}], "]"}]}]]}], "]"}], 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"4", " ", "π", " ", 
       RowBox[{"λ", "[", 
        RowBox[{"e", ",", "mx"}], "]"}]}], ")"}], 
     RowBox[{"3", "/", "2"}]]], 
   FractionBox["c", 
    RowBox[{"4", "π"}]], "lum"}]}]], "Input",
 CellChangeTimes->{{3.738282238961502*^9, 3.738282296077668*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{
     RowBox[{"ϕe", "[", 
      RowBox[{"e", ",", "mx", ",", "d"}], "]"}], "/.", 
     RowBox[{"e", "->", 
      RowBox[{"r", " ", "mx"}]}]}], ")"}], 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"r", "-", "1"}], ")"}], 
    RowBox[{"3", "/", "2"}]]}], "//", "Simplify"}]], "Input",
 CellChangeTimes->{{3.738695250327848*^9, 3.7386952769142303`*^9}, {
  3.7386953240752287`*^9, 3.73869533679281*^9}}],

Cell[BoxData[
 FormBox[
  FractionBox[
   RowBox[{"c", " ", 
    SuperscriptBox["e0", "2"], " ", "lum", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"r", "-", "1"}], ")"}], 
     RowBox[{"3", "/", "2"}]], " ", 
    RowBox[{"exp", "(", 
     FractionBox[
      RowBox[{"b0", " ", 
       SuperscriptBox["d", "2"], " ", 
       RowBox[{"(", 
        RowBox[{"δ", "-", "1"}], ")"}], " ", "mx", " ", "r"}], 
      RowBox[{"4", " ", "d0", " ", 
       SuperscriptBox["e0", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{"mx", " ", "r"}], "e0"], ")"}], "δ"], "-", 
         RowBox[{"r", " ", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mx", "e0"], ")"}], "δ"]}]}], ")"}]}]], 
     ")"}]}], 
   RowBox[{"32", " ", 
    SuperscriptBox["π", 
     RowBox[{"5", "/", "2"}]], " ", "b0", " ", 
    SuperscriptBox["mx", "2"], " ", 
    SuperscriptBox["r", "2"], " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox[
       RowBox[{"d0", " ", 
        SuperscriptBox["e0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"r", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["mx", "e0"], ")"}], "δ"]}], "-", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             RowBox[{"mx", " ", "r"}], "e0"], ")"}], "δ"]}], ")"}]}], 
       RowBox[{"b0", " ", 
        RowBox[{"(", 
         RowBox[{"δ", "-", "1"}], ")"}], " ", "mx", " ", "r"}]], ")"}], 
     RowBox[{"3", "/", "2"}]]}]], TraditionalForm]], "Output",
 CellChangeTimes->{
  3.738695263396902*^9, {3.7386953024455643`*^9, 3.738695337460972*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"ϕe", "[", 
    RowBox[{"e", ",", "mx", ",", "d"}], "]"}], "/.", 
   RowBox[{"e", "->", 
    RowBox[{"r", " ", "mx"}]}]}], "//", "Simplify"}], "", 
 RowBox[{
  RowBox[{
   RowBox[{"Series", "[", 
    RowBox[{"%", ",", 
     RowBox[{"{", 
      RowBox[{"r", ",", "1", ",", "1"}], "}"}]}], "]"}], "//", "Normal"}], 
  ";"}], "", 
 RowBox[{
  RowBox[{
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"r", "-", "1"}], ")"}], 
    RowBox[{"3", "/", "2"}]], "*", "%"}], "//", "Simplify"}]}], "Input",
 CellChangeTimes->{{3.7386937896896257`*^9, 3.7386938360448427`*^9}, {
  3.738695130048998*^9, 3.7386951994387693`*^9}}],

Cell[BoxData[
 FormBox[
  FractionBox[
   RowBox[{"c", " ", 
    SuperscriptBox["e0", "2"], " ", "lum", " ", 
    RowBox[{"exp", "(", 
     FractionBox[
      RowBox[{"b0", " ", 
       SuperscriptBox["d", "2"], " ", 
       RowBox[{"(", 
        RowBox[{"δ", "-", "1"}], ")"}], " ", "mx", " ", "r"}], 
      RowBox[{"4", " ", "d0", " ", 
       SuperscriptBox["e0", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{"mx", " ", "r"}], "e0"], ")"}], "δ"], "-", 
         RowBox[{"r", " ", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mx", "e0"], ")"}], "δ"]}]}], ")"}]}]], 
     ")"}]}], 
   RowBox[{"32", " ", 
    SuperscriptBox["π", 
     RowBox[{"5", "/", "2"}]], " ", "b0", " ", 
    SuperscriptBox["mx", "2"], " ", 
    SuperscriptBox["r", "2"], " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox[
       RowBox[{"d0", " ", 
        SuperscriptBox["e0", "2"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"r", " ", 
           SuperscriptBox[
            RowBox[{"(", 
             FractionBox["mx", "e0"], ")"}], "δ"]}], "-", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             RowBox[{"mx", " ", "r"}], "e0"], ")"}], "δ"]}], ")"}]}], 
       RowBox[{"b0", " ", 
        RowBox[{"(", 
         RowBox[{"δ", "-", "1"}], ")"}], " ", "mx", " ", "r"}]], ")"}], 
     RowBox[{"3", "/", "2"}]]}]], TraditionalForm]], "Output",
 CellChangeTimes->{{3.738693799058056*^9, 3.738693836495223*^9}, {
  3.738695148102022*^9, 3.7386951999080067`*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{
   FractionBox["1", 
    RowBox[{"1024", " ", 
     SuperscriptBox["π", 
      RowBox[{"5", "/", "2"}]], " ", 
     SuperscriptBox["d0", "2"], " ", 
     SuperscriptBox["e0", "2"]}]], 
   RowBox[{"b0", " ", "c", " ", "lum", " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"7", " ", 
       SuperscriptBox["δ", "2"]}], "+", 
      RowBox[{"52", " ", "δ"}], "+", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"7", " ", 
          SuperscriptBox["δ", "2"]}], "+", 
         RowBox[{"28", " ", "δ"}], "+", "12"}], ")"}], " ", 
       SuperscriptBox["r", "2"]}], "-", 
      RowBox[{"2", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"7", " ", 
          SuperscriptBox["δ", "2"]}], "+", 
         RowBox[{"40", " ", "δ"}], "+", "20"}], ")"}], " ", "r"}], "+",
       "60"}], ")"}], " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["mx", "e0"], ")"}], 
     RowBox[{
      RowBox[{"-", "2"}], " ", "δ"}]], " ", 
    SqrtBox[
     RowBox[{"-", 
      FractionBox[
       RowBox[{"d0", " ", "e0", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["mx", "e0"], ")"}], 
         RowBox[{"δ", "-", "1"}]]}], "b0"]}]], " ", 
    RowBox[{"exp", "(", 
     FractionBox[
      RowBox[{"b0", " ", 
       SuperscriptBox["d", "2"], " ", 
       RowBox[{"(", 
        RowBox[{"δ", "-", "1"}], ")"}], " ", "mx", " ", "r"}], 
      RowBox[{"4", " ", "d0", " ", 
       SuperscriptBox["e0", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           FractionBox[
            RowBox[{"mx", " ", "r"}], "e0"], ")"}], "δ"], "-", 
         RowBox[{"r", " ", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox["mx", "e0"], ")"}], "δ"]}]}], ")"}]}]], 
     ")"}]}]}], TraditionalForm]], "Output",
 CellChangeTimes->{{3.738693799058056*^9, 3.738693836495223*^9}, {
  3.738695148102022*^9, 3.738695199979147*^9}}]
}, Closed]],

Cell[BoxData[
 RowBox[{
  RowBox[{"ρ", "[", "r_", "]"}], ":=", 
  RowBox[{"ρs", 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"r", "/", "rs"}], ")"}], 
    RowBox[{"-", "γ"}]], 
   SuperscriptBox[
    RowBox[{"(", 
     RowBox[{"1", "+", 
      RowBox[{"r", "/", "rs"}]}], ")"}], 
    RowBox[{"γ", "-", "3"}]]}]}]], "Input",
 CellChangeTimes->{{3.73842328421449*^9, 3.738423303166827*^9}}],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"rs", "=", "0.1"}], ",", 
     RowBox[{"ρs", "=", "1*^5"}], ",", 
     RowBox[{"sv", "=", "3*^-26"}], ",", 
     RowBox[{"mx", "=", "1500."}], ",", 
     RowBox[{"d", "=", "0.2"}], ",", 
     RowBox[{"e", "=", "1300."}], ",", 
     RowBox[{"d0", "=", 
      SuperscriptBox["10", "28"]}], ",", 
     RowBox[{"δ", "=", "0.7"}], ",", 
     RowBox[{"b0", "=", 
      SuperscriptBox["10", 
       RowBox[{"-", "16"}]]}], ",", 
     RowBox[{"e0", "=", "1"}], ",", 
     RowBox[{"γ", "=", "0.5"}], ",", 
     RowBox[{"c", "=", "3*^10"}]}], "}"}], ",", "", 
   RowBox[{
    RowBox[{
     RowBox[{"ρ", "[", "r_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ρ", ",", "ρmax"}], "}"}], ",", 
       "", 
       RowBox[{
        RowBox[{"ρ", "=", 
         RowBox[{"ρs", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"r", "/", "rs"}], ")"}], 
           RowBox[{"-", "γ"}]], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"r", "/", "rs"}]}], ")"}], 
           RowBox[{"γ", "-", "3"}]]}]}], ";", "", 
        RowBox[{"ρmax", "=", 
         RowBox[{"mx", "/", 
          RowBox[{"(", 
           RowBox[{
           "sv", "*", "1*^10", "*", "365", "*", "24", "*", "60", "*", "60"}], 
           ")"}]}]}], ";", "", 
        RowBox[{"Min", "[", 
         RowBox[{"ρ", ",", "ρmax"}], "]"}]}]}], 
      "", "]"}]}], ";", "", 
    "", 
    RowBox[{
     RowBox[{"b", "[", "e_", "]"}], ":=", 
     FractionBox[
      RowBox[{"b0", " ", 
       SuperscriptBox["e", "2"]}], 
      SuperscriptBox["e0", "2"]]}], ";", "", 
    RowBox[{
     RowBox[{"λ", "[", 
      RowBox[{"e_", ",", "mx_"}], "]"}], ":=", 
     FractionBox[
      RowBox[{
       RowBox[{"d0", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["e", "e0"], ")"}], "δ"], " ", 
        SuperscriptBox["e0", "2"], " ", "mx"}], "-", 
       RowBox[{"d0", " ", "e", " ", 
        SuperscriptBox["e0", "2"], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["mx", "e0"], ")"}], "δ"]}]}], 
      RowBox[{
       RowBox[{"b0", " ", "e", " ", "mx"}], "-", 
       RowBox[{"b0", " ", "e", " ", "mx", " ", "δ"}]}]]}], ";", 
    "", "", 
    RowBox[{
     FractionBox[
      RowBox[{"π", " ", "sv", " ", "c"}], 
      RowBox[{" ", 
       RowBox[{
        SuperscriptBox["mx", "2"], 
        RowBox[{"b", "[", "e", "]"}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"4", "π", " ", 
           RowBox[{"λ", "[", 
            RowBox[{"e", ",", "mx"}], "]"}]}], ")"}], 
         RowBox[{"3", "/", "2"}]]}]}]], 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        SuperscriptBox["r", "2"], 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox[
           SuperscriptBox["r", "2"], 
           RowBox[{"4", " ", 
            RowBox[{"λ", "[", 
             RowBox[{"e", ",", "mx"}], "]"}]}]]}], "]"}], 
        SuperscriptBox[
         RowBox[{"ρ", "[", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["r", "2"], "+", 
            SuperscriptBox["d", "2"], "-", 
            RowBox[{"2", "d", " ", "r", " ", "cθ"}]}]], "]"}], "2"]}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"r", ",", "0", ",", 
         RowBox[{"10", "*", "d"}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"cθ", ",", 
         RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
       RowBox[{"WorkingPrecision", "->", "30"}]}], "]"}]}]}]}], 
  "", "]"}]], "Input",
 CellChangeTimes->{{3.738423304718309*^9, 3.738423361145369*^9}, {
   3.7384234635250053`*^9, 3.7384234650943937`*^9}, {3.738423829715551*^9, 
   3.73842387653785*^9}, {3.738424387188509*^9, 3.7384244173700867`*^9}, {
   3.7384244495525713`*^9, 3.7384244535151653`*^9}, {3.7384268099654503`*^9, 
   3.738427230123579*^9}, 3.738427306212858*^9, {3.738427800007862*^9, 
   3.738427806442891*^9}, {3.738427859812819*^9, 3.738427896749899*^9}, {
   3.738427960978241*^9, 3.738427971851404*^9}, 3.738428248100762*^9, 
   3.738428297658003*^9, {3.738428488025034*^9, 3.738428514977708*^9}, {
   3.738428561092208*^9, 3.73842857783302*^9}, 3.7384286112097063`*^9, 
   3.7384287118308*^9, {3.738429515137944*^9, 3.7384295436141157`*^9}, {
   3.73842969983785*^9, 3.738429700460618*^9}, {3.738429753665159*^9, 
   3.73842979269274*^9}, {3.738429827558826*^9, 3.7384298276702747`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"rs", "=", "0.1"}], ",", 
     RowBox[{"ρs", "=", "1*^5"}], ",", 
     RowBox[{"sv", "=", "3*^-26"}], ",", 
     RowBox[{"mx", "=", "1500."}], ",", 
     RowBox[{"d", "=", "0.2"}], ",", 
     RowBox[{"e", "=", "1300."}], ",", 
     RowBox[{"d0", "=", 
      SuperscriptBox["10", "28"]}], ",", 
     RowBox[{"δ", "=", "0.7"}], ",", 
     RowBox[{"b0", "=", 
      SuperscriptBox["10", 
       RowBox[{"-", "16"}]]}], ",", 
     RowBox[{"e0", "=", "1"}], ",", 
     RowBox[{"γ", "=", "0.5"}], ",", 
     RowBox[{"c", "=", "3*^10"}]}], "}"}], ",", "", 
   RowBox[{
    RowBox[{
     RowBox[{"ρ", "[", "r_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"ρ", ",", "ρmax"}], "}"}], ",", 
       "", 
       RowBox[{
        RowBox[{"ρ", "=", 
         RowBox[{"ρs", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"r", "/", "rs"}], ")"}], 
           RowBox[{"-", "γ"}]], 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"1", "+", 
             RowBox[{"r", "/", "rs"}]}], ")"}], 
           RowBox[{"γ", "-", "3"}]]}]}], ";", "", 
        RowBox[{"ρmax", "=", 
         RowBox[{"mx", "/", 
          RowBox[{"(", 
           RowBox[{
           "sv", "*", "1*^10", "*", "365", "*", "24", "*", "60", "*", "60"}], 
           ")"}]}]}], ";", "", 
        RowBox[{"Min", "[", 
         RowBox[{"ρ", ",", "ρmax"}], "]"}]}]}], 
      "", "]"}]}], ";", "", 
    "", 
    RowBox[{
     RowBox[{"b", "[", "e_", "]"}], ":=", 
     FractionBox[
      RowBox[{"b0", " ", 
       SuperscriptBox["e", "2"]}], 
      SuperscriptBox["e0", "2"]]}], ";", "", 
    RowBox[{
     RowBox[{"λ", "[", 
      RowBox[{"e_", ",", "mx_"}], "]"}], ":=", 
     FractionBox[
      RowBox[{
       RowBox[{"d0", " ", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["e", "e0"], ")"}], "δ"], " ", 
        SuperscriptBox["e0", "2"], " ", "mx"}], "-", 
       RowBox[{"d0", " ", "e", " ", 
        SuperscriptBox["e0", "2"], " ", 
        SuperscriptBox[
         RowBox[{"(", 
          FractionBox["mx", "e0"], ")"}], "δ"]}]}], 
      RowBox[{
       RowBox[{"b0", " ", "e", " ", "mx"}], "-", 
       RowBox[{"b0", " ", "e", " ", "mx", " ", "δ"}]}]]}], ";", 
    "", 
    RowBox[{"θterm", "=", 
     RowBox[{
      FractionBox["1", 
       RowBox[{"2", " ", "d", " ", "r", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", "γ"}], ")"}]}]], 
      RowBox[{
       SuperscriptBox["ρs", "2"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"d", "-", "r"}], ")"}], "2"], " ", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             SqrtBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"d", "-", "r"}], ")"}], "2"]], "rs"], ")"}], 
           RowBox[{
            RowBox[{"-", "2"}], " ", "γ"}]], " ", 
          RowBox[{"Hypergeometric2F1", "[", 
           RowBox[{
            RowBox[{"2", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"6", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"3", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"-", 
             FractionBox[
              SqrtBox[
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"d", "-", "r"}], ")"}], "2"]], "rs"]}]}], "]"}]}], 
         "-", 
         RowBox[{
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{"d", "+", "r"}], ")"}], "2"], " ", 
          SuperscriptBox[
           RowBox[{"(", 
            FractionBox[
             SqrtBox[
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"d", "+", "r"}], ")"}], "2"]], "rs"], ")"}], 
           RowBox[{
            RowBox[{"-", "2"}], " ", "γ"}]], " ", 
          RowBox[{"Hypergeometric2F1", "[", 
           RowBox[{
            RowBox[{"2", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"6", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"3", "-", 
             RowBox[{"2", " ", "γ"}]}], ",", 
            RowBox[{"-", 
             FractionBox[
              SqrtBox[
               SuperscriptBox[
                RowBox[{"(", 
                 RowBox[{"d", "+", "r"}], ")"}], "2"]], "rs"]}]}], "]"}]}]}], 
        ")"}]}]}]}], ";", "", "", 
    RowBox[{
     FractionBox[
      RowBox[{"π", " ", "sv", " ", "c"}], 
      RowBox[{" ", 
       RowBox[{
        SuperscriptBox["mx", "2"], 
        RowBox[{"b", "[", "e", "]"}], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"4", "π", " ", 
           RowBox[{"λ", "[", 
            RowBox[{"e", ",", "mx"}], "]"}]}], ")"}], 
         RowBox[{"3", "/", "2"}]]}]}]], 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        SuperscriptBox["r", "2"], 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox[
           SuperscriptBox["r", "2"], 
           RowBox[{"4", " ", 
            RowBox[{"λ", "[", 
             RowBox[{"e", ",", "mx"}], "]"}]}]]}], "]"}], "θterm"}], 
       ",", 
       RowBox[{"{", 
        RowBox[{"r", ",", "0", ",", 
         RowBox[{"100", "*", "d"}]}], "}"}]}], "]"}]}]}]}], 
  "", "]"}]], "Input",
 CellChangeTimes->{{3.7384305253995028`*^9, 3.7384305597090187`*^9}, 
   3.738430655176855*^9}],

Cell[BoxData[
 FormBox[
  RowBox[{
   StyleBox[
    RowBox[{"NIntegrate", "::", "ncvb"}], "MessageName"], ":", 
   " ", "\<\"NIntegrate failed to converge to prescribed accuracy after \
\\!\\(TraditionalForm\\`9\\) recursive bisections in \
\\!\\(TraditionalForm\\`r\\) near \
\\!\\(TraditionalForm\\`\\({r}\\)\\) = \
\\!\\(TraditionalForm\\`\\({0.21014729743477156`}\\)\\). \
NIntegrate obtained \
\\!\\(TraditionalForm\\`1.6665526240763706`*^6\\) and \
\\!\\(TraditionalForm\\`491.10936861277787`\\) for the \
integral and error estimates. \\!\\(\\*ButtonBox[\\\">>\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/NIntegrate/ncvb\\\", ButtonNote -> \
\\\"NIntegrate::ncvb\\\"]\\)\"\>"}], TraditionalForm]], "Message", "MSG",
 CellChangeTimes->{3.738430560792651*^9, 3.738430656214134*^9}],

Cell[BoxData[
 FormBox["1.3368167139171163`*^-70", TraditionalForm]], "Output",
 CellChangeTimes->{3.738430560793713*^9, 3.7384306562165194`*^9}]
}, Closed]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Integrate", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"ρ", "[", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["r", "2"], "+", 
            SuperscriptBox["d", "2"], "-", 
            RowBox[{"2", "d", " ", "r", " ", "cθ"}]}]], "]"}], "2"], 
        ",", "cθ"}], "]"}], "/.", 
      RowBox[{"cθ", "->", "1"}]}], ")"}], "-", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Integrate", "[", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"ρ", "[", 
          SqrtBox[
           RowBox[{
            SuperscriptBox["r", "2"], "+", 
            SuperscriptBox["d", "2"], "-", 
            RowBox[{"2", "d", " ", "r", " ", "cθ"}]}]], "]"}], "2"], 
        ",", "cθ"}], "]"}], "/.", 
      RowBox[{"cθ", "->", 
       RowBox[{"-", "1"}]}]}], ")"}]}], "//", "Simplify"}], "//", 
  "StandardForm"}], "", 
 RowBox[{"%", "//", "FortranForm"}]}], "Input",
 CellChangeTimes->{{3.738430011330352*^9, 3.738430021983677*^9}, {
  3.738430076064959*^9, 3.73843008921152*^9}, {3.738430209401185*^9, 
  3.7384302145126543`*^9}, {3.738430502535605*^9, 3.738430508569335*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  FractionBox[
   RowBox[{
    RowBox[{"d0", " ", 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["e", "e0"], ")"}], "δ"], " ", 
     SuperscriptBox["e0", "2"], " ", "mx"}], "-", 
    RowBox[{"d0", " ", "e", " ", 
     SuperscriptBox["e0", "2"], " ", 
     SuperscriptBox[
      RowBox[{"(", 
       FractionBox["mx", "e0"], ")"}], "δ"]}]}], 
   RowBox[{
    RowBox[{"b0", " ", "e", " ", "mx"}], "-", 
    RowBox[{"b0", " ", "e", " ", "mx", " ", "δ"}]}]], "//", 
  RowBox[{
   RowBox[{"FullSimplify", "[", 
    RowBox[{"#", ",", 
     RowBox[{"Assumptions", "->", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"mx", ">", "0"}], ",", 
        RowBox[{"b0", ">", "0"}], ",", 
        RowBox[{"0", "<", "δ", "<", "1"}], ",", 
        RowBox[{"e", ">", "0"}]}], "}"}]}]}], "]"}], "&"}]}]], "Input",
 CellChangeTimes->{{3.743360856142836*^9, 3.7433608895465307`*^9}}],

Cell[BoxData[
 FormBox[
  FractionBox[
   RowBox[{"d0", " ", 
    SuperscriptBox[
     RowBox[{"(", 
      FractionBox["1", "e0"], ")"}], 
     RowBox[{"δ", "-", "2"}]], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"e", " ", 
       SuperscriptBox["mx", "δ"]}], "-", 
      RowBox[{"mx", " ", 
       SuperscriptBox["e", "δ"]}]}], ")"}]}], 
   RowBox[{"b0", " ", 
    RowBox[{"(", 
     RowBox[{"δ", "-", "1"}], ")"}], " ", "e", " ", "mx"}]], 
  TraditionalForm]], "Output",
 CellChangeTimes->{{3.743360858562046*^9, 3.74336088998285*^9}}]
}, Closed]]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Checking convergence of J factor\
\>", "Section",
 CellChangeTimes->{{3.74465090407117*^9, 3.7446509085907373`*^9}, {
  3.7446539114035*^9, 3.744653920005979*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"γ", "=", "1"}], ";"}]], "Input",
 CellChangeTimes->{{3.7446546963504143`*^9, 3.744654705991806*^9}, 
   3.74509103754594*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"θIndefInt", "=", 
   RowBox[{"Integrate", "[", 
    RowBox[{
     SuperscriptBox[
      RowBox[{"rhoNFW0", "[", 
       SqrtBox[
        RowBox[{
         SuperscriptBox["dc", "2"], "+", 
         SuperscriptBox["r", "2"], "-", 
         RowBox[{"2", "dc", " ", "r", " ", "cθ"}]}]], "]"}], "2"], ",",
      "cθ"}], "]"}]}], ";"}], "", 
 RowBox[{
  RowBox[{"temp", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"θIndefInt", "/.", 
      RowBox[{"cθ", "->", "1"}]}], ")"}], "-", 
    RowBox[{"(", 
     RowBox[{"θIndefInt", "/.", 
      RowBox[{"cθ", "->", "cθmax"}]}], ")"}]}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.744651560243011*^9, 3.744651576600359*^9}, {
   3.744651609641118*^9, 3.744651615647051*^9}, {3.7446520909372387`*^9, 
   3.74465209171451*^9}, {3.744653508716865*^9, 3.744653657105049*^9}, {
   3.74465375007386*^9, 3.7446537507340107`*^9}, 3.744653938117114*^9, {
   3.744654503830625*^9, 3.744654504395005*^9}, 3.744654691624403*^9, {
   3.74465515084243*^9, 3.74465515246784*^9}, 3.74465525652748*^9, {
   3.744655370931966*^9, 3.7446553722365303`*^9}, {3.7450910532159243`*^9, 
   3.7450910536132517`*^9}}],

Cell[TextData[{
 "Check that ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    SuperscriptBox[
     SubscriptBox["∫", "0"], 
     SubscriptBox["d", "c"]], 
    RowBox[{"dr", " ", 
     RowBox[{"(", "...", ")"}]}]}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 " converges by performing series expansions near troublesome points ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     RowBox[{"r", "=", "0"}], ",", 
     SubscriptBox["d", "c"], ",", "∞"}], ")"}], TraditionalForm]],
  FormatType->"TraditionalForm"],
 ":"
}], "Text",
 CellChangeTimes->{{3.744653636184772*^9, 3.7446537015807333`*^9}}](*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     54618,       1631]
NotebookOptionsPosition[     51152,       1512]
NotebookOutlinePosition[     51598,       1530]
CellTagsIndexPosition[     51555,       1527]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
  ";"}], "", 
 RowBox[{"lim∞", "=", 
  RowBox[{"Limit", "[", 
   RowBox[{"%", ",", 
    RowBox[{"r", "->", "Infinity"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.744653843775045*^9, 3.744653852223892*^9}, 
   3.744653941100809*^9, 3.7446544957651978`*^9}],

Cell[BoxData[
 FormBox["0", TraditionalForm]], "Output",
 CellChangeTimes->{{3.744654496296472*^9, 3.744654506348418*^9}, 
   3.745090993027564*^9, 3.745091056929332*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"seriesdc", "=", 
   RowBox[{
    RowBox[{"Series", "[", 
     RowBox[{"temp", ",", 
      RowBox[{"{", 
       RowBox[{"r", ",", "dc", ",", "2"}], "}"}]}], "]"}], "//", "Normal"}]}],
   ";"}], "", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"seriesdc", ",", "r"}], "]"}], ";"}], "", 
 RowBox[{"limdc", "=", 
  RowBox[{"Limit", "[", 
   RowBox[{"%", ",", 
    RowBox[{"r", "->", "dc"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{
  3.7446536748875713`*^9, {3.7446537297657347`*^9, 3.744653758409968*^9}, 
   3.7446539419175653`*^9, 3.744654497491962*^9, {3.744654554574617*^9, 
   3.744654554758389*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{
   FractionBox["1", 
    RowBox[{"6", " ", "dc"}]], 
   RowBox[{
    SuperscriptBox["ρs", "2"], " ", 
    SuperscriptBox["rs", "2"], " ", 
    RowBox[{"(", 
     RowBox[{
      FractionBox[
       RowBox[{"rs", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"12", " ", 
            RowBox[{"(", 
             RowBox[{"cθmax", "-", "1"}], ")"}], " ", 
            SuperscriptBox["dc", "2"]}]}], "+", 
          RowBox[{"15", " ", 
           SqrtBox[
            RowBox[{"2", "-", 
             RowBox[{"2", " ", "cθmax"}]}]], " ", "dc", " ", "rs"}], 
          "+", 
          RowBox[{"11", " ", 
           SuperscriptBox["rs", "2"]}]}], ")"}]}], 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SqrtBox[
            RowBox[{"2", "-", 
             RowBox[{"2", " ", "cθmax"}]}]], " ", "dc"}], "+", "rs"}], 
         ")"}], "3"]], "+", 
      RowBox[{"3", " ", 
       RowBox[{"log", "(", 
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"(", 
          RowBox[{"cθmax", "-", "1"}], ")"}], " ", 
         SuperscriptBox["dc", "2"]}], ")"}]}], "-", 
      RowBox[{"6", " ", 
       RowBox[{"log", "(", 
        RowBox[{
         RowBox[{
          SqrtBox[
           RowBox[{"2", "-", 
            RowBox[{"2", " ", "cθmax"}]}]], " ", "dc"}], "+", "rs"}], 
        ")"}]}]}], ")"}]}]}], TraditionalForm]], "Output",
 CellChangeTimes->{{3.744654499295494*^9, 3.74465450920094*^9}, 
   3.744654558320064*^9, 3.745091023999544*^9, 3.7450910827231903`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"series0", "=", 
   RowBox[{
    RowBox[{"Series", "[", 
     RowBox[{"temp", ",", 
      RowBox[{"{", 
       RowBox[{"r", ",", "0", ",", "1"}], "}"}]}], "]"}], "//", "Normal"}]}], 
  ";"}], "", 
 RowBox[{
  RowBox[{"Integrate", "[", 
   RowBox[{"series0", ",", "r"}], "]"}], ";"}], "", 
 RowBox[{"lim0", "=", 
  RowBox[{"Limit", "[", 
   RowBox[{"%", ",", 
    RowBox[{"r", "->", "0"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.744653774772745*^9, 3.744653782602906*^9}, 
   3.7446539428775263`*^9, 3.744654501499748*^9}],

Cell[BoxData[
 FormBox["0", TraditionalForm]], "Output",
 CellChangeTimes->{{3.744654501896845*^9, 3.7446545139673653`*^9}, 
   3.74509102431314*^9, 3.7450910828323803`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"lim0", ",", "limdc", ",", "lim∞"}], "}"}], "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{"dc", "->", "1."}], ",", 
    RowBox[{"rs", "->", "0.1"}], ",", 
    RowBox[{"ρs", "->", "1"}], ",", 
    RowBox[{"cθmax", "->", "0.9"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.7446537959528933`*^9, 3.744653796105538*^9}, {
  3.7446538652433233`*^9, 3.744653883235931*^9}}],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{"0", ",", 
    RowBox[{"-", "3.269391208774083`*^-6"}], ",", "0"}], "}"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{3.7446538840515347`*^9, 3.744654515132202*^9, 
  3.744654563954843*^9, 3.745091024472135*^9, 3.745091082948896*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"mwHaloSubs", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ρs", "->", "0.184"}], ",", 
     RowBox[{"rs", "->", "24.42"}], ",", 
     RowBox[{"dc", "->", "8.33"}]}], "}"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7450911549572697`*^9, 3.745091169415983*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Module", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "i1", ",", "i2", ",", "dist", ",", "wp", ",", "pg", ",", "distMax", ",", 
     "ΔΩ", ",", "cθm", ",", "θ"}], 
    "}"}], ",", "", 
   RowBox[{
    RowBox[{"dist", "=", 
     RowBox[{"dc", "/.", "mwHaloSubs"}]}], ";", "", 
    RowBox[{"distMax", "=", "1000"}], ";", "", 
    RowBox[{"wp", "=", "16"}], ";", "", 
    RowBox[{"pg", "=", "5"}], ";", "", 
    RowBox[{"θ", "=", "1"}], ";", "", 
    RowBox[{"cθm", "=", 
     RowBox[{"Cos", "[", 
      RowBox[{"θ", "*", 
       RowBox[{"π", "/", "180."}]}], "]"}]}], ";", "", 
    
    RowBox[{"ΔΩ", "=", 
     RowBox[{"2", "π", 
      RowBox[{"(", 
       RowBox[{"1", "-", "cθm"}], ")"}]}]}], ";", 
    "", "", 
    RowBox[{"i1", "=", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"temp", "/.", "mwHaloSubs"}], "/.", 
        RowBox[{"cθmax", "->", "cθm"}]}], ",", 
       "", 
       RowBox[{"{", 
        RowBox[{"r", ",", "0", ",", "dist"}], "}"}], ",", 
       "", 
       RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
       "", 
       RowBox[{"PrecisionGoal", "->", "pg"}]}], "", 
      "]"}]}], ";", "", "", 
    RowBox[{"i2", "=", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"temp", "/.", "mwHaloSubs"}], "/.", 
        RowBox[{"cθmax", "->", "cθm"}]}], ",", 
       "", 
       RowBox[{"{", 
        RowBox[{"r", ",", "dist", ",", "distMax"}], "}"}], ",", 
       "", 
       RowBox[{"WorkingPrecision", "->", "wp"}], ",", 
       "", 
       RowBox[{"PrecisionGoal", "->", "pg"}]}], "", 
      "]"}]}], ";", "", "", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"Re", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"i1", "+", "i2"}], ")"}], 
         FractionBox["1", 
          RowBox[{
           SuperscriptBox["ρs", "2"], "rs"}]], 
         FractionBox[
          RowBox[{"2", "π"}], "ΔΩ"]}], "/.", 
        "mwHaloSubs"}], "]"}], ",", 
      RowBox[{
       FractionBox["1", 
        RowBox[{
         SuperscriptBox["ρs", "2"], "rs"}]], "/.", "mwHaloSubs"}]}], 
     "}"}]}]}], "", "]"}]], "Input",
 CellChangeTimes->{{3.744654723432619*^9, 3.744654743175852*^9}, {
   3.7446553606648407`*^9, 3.744655529934599*^9}, {3.744655581587323*^9, 
   3.7446556240092707`*^9}, {3.744655688914691*^9, 3.74465569130462*^9}, {
   3.7446557902259197`*^9, 3.744655792698398*^9}, {3.744655824752783*^9, 
   3.744655841781221*^9}, {3.744655903315112*^9, 3.744655904206204*^9}, {
   3.7446559726122437`*^9, 3.7446560428440933`*^9}, {3.745091073664607*^9, 
   3.745091076357224*^9}, {3.7450911748946857`*^9, 3.745091408862715*^9}, {
   3.745091447742278*^9, 3.74509152722885*^9}, {3.7450915592833357`*^9, 
   3.7450916239201307`*^9}, 3.745092350781435*^9, 3.745092387677455*^9, 
   3.745092444072769*^9}],

Cell[BoxData[
 FormBox[
  RowBox[{"{", 
   RowBox[{"1013.1348088668657`", ",", "1.209535708590529`"}], "}"}], 
  TraditionalForm]], "Output",
 CellChangeTimes->{
  3.74509112345688*^9, 3.74509119473523*^9, 3.745091253333723*^9, {
   3.7450913096427307`*^9, 3.7450914094076157`*^9}, {3.745091453023787*^9, 
   3.745091529257209*^9}, {3.745091569881404*^9, 3.745091624551017*^9}, {
   3.745092368103467*^9, 3.745092388216979*^9}, 3.7450924448590517`*^9, {
   3.745092515886353*^9, 3.745092529951926*^9}, {3.745092717674781*^9, 
   3.7450927274283743`*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"Clear", "[", "γ", "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.744654707518572*^9, 3.744654710551853*^9}}]
}, Open  ]]
},
WindowSize->{720, 855},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
ShowSelection->True,
FrontEndVersion->"9.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (January 25, \
2013)",
StyleDefinitions->FrontEnd`FileName[{"Report"}, "StandardReport.nb", 
  CharacterEncoding -> "UTF-8"]
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[579, 22, 104, 1, 82, "Section"],
Cell[686, 25, 1987, 62, 191, "Text"],
Cell[2676, 89, 423, 11, 37, "Input"],
Cell[3102, 102, 140, 3, 30, "Text"],
Cell[3245, 107, 809, 22, 56, "Input"],
Cell[4057, 131, 82, 1, 30, "Text"],
Cell[4142, 134, 683, 16, 55, "Input"],
Cell[CellGroupData[{
Cell[4850, 154, 431, 11, 37, "Input"],
Cell[5284, 167, 227, 4, 41, "Output"]
}, Closed]],
Cell[CellGroupData[{
Cell[5548, 176, 285, 7, 37, "Input"],
Cell[5836, 185, 815, 16, 203, "Output"]
}, Closed]],
Cell[CellGroupData[{
Cell[6688, 206, 572, 15, 55, "Input"],
Cell[7263, 223, 1372, 24, 293, "Output"]
}, Closed]],
Cell[CellGroupData[{
Cell[8672, 252, 273, 7, 37, "Input"],
Cell[8948, 261, 636, 11, 158, "Output"]
}, Closed]],
Cell[CellGroupData[{
Cell[9621, 277, 418, 10, 44, "Input"],
Cell[10042, 289, 1084, 32, 67, "Output"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[11175, 327, 92, 1, 52, "Section"],
Cell[11270, 330, 1179, 34, 106, "Input"],
Cell[CellGroupData[{
Cell[12474, 368, 945, 25, 55, "Input"],
Cell[13422, 395, 813, 20, 65, "Output"]
}, Closed]],
Cell[14250, 418, 736, 23, 74, "Input"],
Cell[CellGroupData[{
Cell[15011, 445, 479, 14, 41, "Input"],
Cell[15493, 461, 1774, 53, 116, "Output"]
}, Closed]],
Cell[CellGroupData[{
Cell[17304, 519, 712, 21, 74, "Input"],
Cell[18019, 542, 1683, 49, 116, "Output"],
Cell[19705, 593, 2060, 62, 138, "Output"]
}, Closed]],
Cell[21780, 658, 418, 13, 41, "Input"],
Cell[22201, 673, 4867, 126, 431, "Input"],
Cell[CellGroupData[{
Cell[27093, 803, 5976, 172, 676, "Input"],
Cell[33072, 977, 966, 17, 62, "Message"],
Cell[34041, 996, 145, 2, 42, "Output"]
}, Closed]],
Cell[34201, 1001, 1284, 35, 116, "Input"],
Cell[CellGroupData[{
Cell[35510, 1040, 939, 27, 86, "Input"],
Cell[36452, 1069, 574, 18, 73, "Output"]
}, Closed]]
}, Closed]],
Cell[CellGroupData[{
Cell[37075, 1093, 173, 4, 52, "Section"],
Cell[37251, 1099, 167, 4, 37, "Input"],
Cell[37421, 1105, 1256, 30, 75, "Input"],
Cell[38680, 1137, 633, 21, 58, "Text"],
Cell[CellGroupData[{
Cell[39338, 1162, 659, 18, 72, "Input"],
Cell[40000, 1182, 170, 3, 41, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40207, 1190, 688, 19, 72, "Input"],
Cell[40898, 1211, 1636, 50, 124, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42571, 1266, 604, 17, 72, "Input"],
Cell[43178, 1285, 173, 3, 41, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43388, 1293, 461, 11, 37, "Input"],
Cell[43852, 1306, 292, 7, 45, "Output"]
}, Open  ]],
Cell[44159, 1316, 318, 8, 37, "Input"],
Cell[CellGroupData[{
Cell[44502, 1328, 3466, 80, 458, "Input"],
Cell[47971, 1410, 554, 11, 41, "Output"]
}, Open  ]],
Cell[48540, 1424, 149, 3, 37, "Input"]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
